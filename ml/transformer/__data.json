{"type":"data","nodes":[null,{"type":"data","data":[{"prev":1,"next":4,"section":7},{"slug":2,"title":3},"ml\u002Fml_interview","ML Interview",{"slug":5,"title":6},"ml\u002Fvision_transformer","Vision Transformer",{"file":8,"title":9,"date":10,"summary":-1,"tag":11,"toc":14,"body":15},"ml\u002F10-transformer.md","Transformer","Feb. 5, 2023",[12,13],"ml","transformer","\u003Ch4\u003EContents\u003C\u002Fh4\u003E\u003Cp class=\"toc-h2\"\u003E\u003Ca href=\"#attention-is-all-you-need-vaswani-et-al-2017\"\u003EAttention is All you Need (Vaswani, et al., 2017)\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp class=\"toc-h3\"\u003E\u003Ca href=\"#encoder-layer\"\u003EEncoder Layer\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp class=\"toc-h3\"\u003E\u003Ca href=\"#decoder-layer\"\u003EDecoder Layer\u003C\u002Fa\u003E\u003C\u002Fp\u003E","\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Flilianweng.github.io\u002Fposts\u002F2023-01-27-the-transformer-family-v2\u002F\"\u003Ehttps:\u002F\u002Flilianweng.github.io\u002Fposts\u002F2023-01-27-the-transformer-family-v2\u002F\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Ch2 id=\"attention-is-all-you-need-vaswani-et-al-2017\"\u003EAttention is All you Need (Vaswani, et al., 2017)\u003Ca href=\"#attention-is-all-you-need-vaswani-et-al-2017\" class=\"anchor\"\u003E\u003Cspan class=\"visually-hidden\"\u003E#\u003C\u002Fspan\u003E\u003C\u002Fa\u003E\u003C\u002Fh2\u003E\u003Cdiv class=\"katex-div\"\u003E\u003Cpre class='katex-pre'\u003E\u003Cspan class=\"katex\"\u003E\u003Cspan class=\"katex-mathml\"\u003E\u003Cmath xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML\"\u003E\u003Csemantics\u003E\u003Cmtable rowspacing=\"0.25em\" columnalign=\"right left\" columnspacing=\"0em\"\u003E\u003Cmtr\u003E\u003Cmtd\u003E\u003Cmstyle scriptlevel=\"0\" displaystyle=\"true\"\u003E\u003Cmrow\u003E\u003Cmtext\u003Eattn\u003C\u002Fmtext\u003E\u003Cmo stretchy=\"false\"\u003E(\u003C\u002Fmo\u003E\u003Cmi mathvariant=\"bold\"\u003EQ\u003C\u002Fmi\u003E\u003Cmo separator=\"true\"\u003E,\u003C\u002Fmo\u003E\u003Cmi mathvariant=\"bold\"\u003EK\u003C\u002Fmi\u003E\u003Cmo separator=\"true\"\u003E,\u003C\u002Fmo\u003E\u003Cmi mathvariant=\"bold\"\u003EV\u003C\u002Fmi\u003E\u003Cmo stretchy=\"false\"\u003E)\u003C\u002Fmo\u003E\u003C\u002Fmrow\u003E\u003C\u002Fmstyle\u003E\u003C\u002Fmtd\u003E\u003Cmtd\u003E\u003Cmstyle scriptlevel=\"0\" displaystyle=\"true\"\u003E\u003Cmrow\u003E\u003Cmrow\u003E\u003C\u002Fmrow\u003E\u003Cmo\u003E=\u003C\u002Fmo\u003E\u003Cmtext\u003Esoftmax\u003C\u002Fmtext\u003E\u003Cmo stretchy=\"false\"\u003E(\u003C\u002Fmo\u003E\u003Cmfrac\u003E\u003Cmrow\u003E\u003Cmi mathvariant=\"bold\"\u003EQ\u003C\u002Fmi\u003E\u003Cmsup\u003E\u003Cmi mathvariant=\"bold\"\u003EK\u003C\u002Fmi\u003E\u003Cmi mathvariant=\"normal\"\u003E⊤\u003C\u002Fmi\u003E\u003C\u002Fmsup\u003E\u003C\u002Fmrow\u003E\u003Cmsqrt\u003E\u003Cmsub\u003E\u003Cmi\u003Ed\u003C\u002Fmi\u003E\u003Cmi\u003Ek\u003C\u002Fmi\u003E\u003C\u002Fmsub\u003E\u003C\u002Fmsqrt\u003E\u003C\u002Fmfrac\u003E\u003Cmo stretchy=\"false\"\u003E)\u003C\u002Fmo\u003E\u003Cmi mathvariant=\"bold\"\u003EV\u003C\u002Fmi\u003E\u003C\u002Fmrow\u003E\u003C\u002Fmstyle\u003E\u003C\u002Fmtd\u003E\u003C\u002Fmtr\u003E\u003Cmtr\u003E\u003Cmtd\u003E\u003Cmstyle scriptlevel=\"0\" displaystyle=\"true\"\u003E\u003Cmrow\u003E\u003Cmtext\u003EMultiHeadAttn\u003C\u002Fmtext\u003E\u003Cmo stretchy=\"false\"\u003E(\u003C\u002Fmo\u003E\u003Cmsub\u003E\u003Cmi mathvariant=\"bold\"\u003EX\u003C\u002Fmi\u003E\u003Cmi\u003Eq\u003C\u002Fmi\u003E\u003C\u002Fmsub\u003E\u003Cmo separator=\"true\"\u003E,\u003C\u002Fmo\u003E\u003Cmsub\u003E\u003Cmi mathvariant=\"bold\"\u003EX\u003C\u002Fmi\u003E\u003Cmi\u003Ek\u003C\u002Fmi\u003E\u003C\u002Fmsub\u003E\u003Cmo separator=\"true\"\u003E,\u003C\u002Fmo\u003E\u003Cmsub\u003E\u003Cmi mathvariant=\"bold\"\u003EX\u003C\u002Fmi\u003E\u003Cmi\u003Ev\u003C\u002Fmi\u003E\u003C\u002Fmsub\u003E\u003Cmo stretchy=\"false\"\u003E)\u003C\u002Fmo\u003E\u003C\u002Fmrow\u003E\u003C\u002Fmstyle\u003E\u003C\u002Fmtd\u003E\u003Cmtd\u003E\u003Cmstyle scriptlevel=\"0\" displaystyle=\"true\"\u003E\u003Cmrow\u003E\u003Cmrow\u003E\u003C\u002Fmrow\u003E\u003Cmo\u003E=\u003C\u002Fmo\u003E\u003Cmo stretchy=\"false\"\u003E[\u003C\u002Fmo\u003E\u003Cmsub\u003E\u003Cmtext\u003Ehead\u003C\u002Fmtext\u003E\u003Cmn\u003E1\u003C\u002Fmn\u003E\u003C\u002Fmsub\u003E\u003Cmo separator=\"true\"\u003E;\u003C\u002Fmo\u003E\u003Cmo\u003E…\u003C\u002Fmo\u003E\u003Cmtext\u003E \u003C\u002Fmtext\u003E\u003Cmo separator=\"true\"\u003E;\u003C\u002Fmo\u003E\u003Cmsub\u003E\u003Cmtext\u003Ehead\u003C\u002Fmtext\u003E\u003Cmi\u003Eh\u003C\u002Fmi\u003E\u003C\u002Fmsub\u003E\u003Cmo stretchy=\"false\"\u003E]\u003C\u002Fmo\u003E\u003Cmsup\u003E\u003Cmi mathvariant=\"bold\"\u003EW\u003C\u002Fmi\u003E\u003Cmi\u003Eo\u003C\u002Fmi\u003E\u003C\u002Fmsup\u003E\u003C\u002Fmrow\u003E\u003C\u002Fmstyle\u003E\u003C\u002Fmtd\u003E\u003C\u002Fmtr\u003E\u003Cmtr\u003E\u003Cmtd\u003E\u003Cmstyle scriptlevel=\"0\" displaystyle=\"true\"\u003E\u003Cmsub\u003E\u003Cmtext\u003Ewhere head\u003C\u002Fmtext\u003E\u003Cmi\u003Ei\u003C\u002Fmi\u003E\u003C\u002Fmsub\u003E\u003C\u002Fmstyle\u003E\u003C\u002Fmtd\u003E\u003Cmtd\u003E\u003Cmstyle scriptlevel=\"0\" displaystyle=\"true\"\u003E\u003Cmrow\u003E\u003Cmrow\u003E\u003C\u002Fmrow\u003E\u003Cmo\u003E=\u003C\u002Fmo\u003E\u003Cmtext\u003EAttention\u003C\u002Fmtext\u003E\u003Cmo stretchy=\"false\"\u003E(\u003C\u002Fmo\u003E\u003Cmsub\u003E\u003Cmi mathvariant=\"bold\"\u003EX\u003C\u002Fmi\u003E\u003Cmi\u003Eq\u003C\u002Fmi\u003E\u003C\u002Fmsub\u003E\u003Cmsubsup\u003E\u003Cmi mathvariant=\"bold\"\u003EW\u003C\u002Fmi\u003E\u003Cmi\u003Ei\u003C\u002Fmi\u003E\u003Cmi\u003Eq\u003C\u002Fmi\u003E\u003C\u002Fmsubsup\u003E\u003Cmo separator=\"true\"\u003E,\u003C\u002Fmo\u003E\u003Cmsub\u003E\u003Cmi mathvariant=\"bold\"\u003EX\u003C\u002Fmi\u003E\u003Cmi\u003Ek\u003C\u002Fmi\u003E\u003C\u002Fmsub\u003E\u003Cmsubsup\u003E\u003Cmi mathvariant=\"bold\"\u003EW\u003C\u002Fmi\u003E\u003Cmi\u003Ei\u003C\u002Fmi\u003E\u003Cmi\u003Ek\u003C\u002Fmi\u003E\u003C\u002Fmsubsup\u003E\u003Cmo separator=\"true\"\u003E,\u003C\u002Fmo\u003E\u003Cmsub\u003E\u003Cmi mathvariant=\"bold\"\u003EX\u003C\u002Fmi\u003E\u003Cmi\u003Ev\u003C\u002Fmi\u003E\u003C\u002Fmsub\u003E\u003Cmsubsup\u003E\u003Cmi mathvariant=\"bold\"\u003EW\u003C\u002Fmi\u003E\u003Cmi\u003Ei\u003C\u002Fmi\u003E\u003Cmi\u003Ev\u003C\u002Fmi\u003E\u003C\u002Fmsubsup\u003E\u003Cmo stretchy=\"false\"\u003E)\u003C\u002Fmo\u003E\u003C\u002Fmrow\u003E\u003C\u002Fmstyle\u003E\u003C\u002Fmtd\u003E\u003C\u002Fmtr\u003E\u003C\u002Fmtable\u003E\u003Cannotation encoding=\"application\u002Fx-tex\"\u003E\\begin{aligned}\n\\text{attn}(\\mathbf{Q}, \\mathbf{K}, \\mathbf{V}) &amp;= \\text{softmax}(\\frac{\\mathbf{Q} {\\mathbf{K}}^\\top}{\\sqrt{d_k}})\\mathbf{V}\\\\\n\\text{MultiHeadAttn}(\\mathbf{X}_q, \\mathbf{X}_k, \\mathbf{X}_v) &amp;= [\\text{head}_1; \\dots; \\text{head}_h] \\mathbf{W}^o \\\\ \n\\text{where head}_i &amp;= \\text{Attention}(\\mathbf{X}_q\\mathbf{W}^q_i, \\mathbf{X}_k\\mathbf{W}^k_i, \\mathbf{X}_v\\mathbf{W}^v_i)\n\\end{aligned}\u003C\u002Fannotation\u003E\u003C\u002Fsemantics\u003E\u003C\u002Fmath\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"katex-html\" aria-hidden=\"true\"\u003E\u003Cspan class=\"base\"\u003E\u003Cspan class=\"strut\" style=\"height:5.8152em;vertical-align:-2.6576em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mord\"\u003E\u003Cspan class=\"mtable\"\u003E\u003Cspan class=\"col-align-r\"\u003E\u003Cspan class=\"vlist-t vlist-t2\"\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:3.1576em;\"\u003E\u003Cspan style=\"top:-5.1576em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:3.5261em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mord\"\u003E\u003Cspan class=\"mord text\"\u003E\u003Cspan class=\"mord\"\u003Eattn\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mopen\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mord mathbf\"\u003EQ\u003C\u002Fspan\u003E\u003Cspan class=\"mpunct\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mord mathbf\"\u003EK\u003C\u002Fspan\u003E\u003Cspan class=\"mpunct\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\"\u003EV\u003C\u002Fspan\u003E\u003Cspan class=\"mclose\"\u003E)\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan style=\"top:-3.0876em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:3.5261em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mord\"\u003E\u003Cspan class=\"mord text\"\u003E\u003Cspan class=\"mord\"\u003EMultiHeadAttn\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mopen\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mord\"\u003E\u003Cspan class=\"mord mathbf\"\u003EX\u003C\u002Fspan\u003E\u003Cspan class=\"msupsub\"\u003E\u003Cspan class=\"vlist-t vlist-t2\"\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.1514em;\"\u003E\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:2.7em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"sizing reset-size6 size3 mtight\"\u003E\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\"\u003Eq\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-s\"\u003E​\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.2861em;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mpunct\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mord\"\u003E\u003Cspan class=\"mord mathbf\"\u003EX\u003C\u002Fspan\u003E\u003Cspan class=\"msupsub\"\u003E\u003Cspan class=\"vlist-t vlist-t2\"\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.3361em;\"\u003E\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:2.7em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"sizing reset-size6 size3 mtight\"\u003E\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\"\u003Ek\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-s\"\u003E​\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.15em;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mpunct\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mord\"\u003E\u003Cspan class=\"mord mathbf\"\u003EX\u003C\u002Fspan\u003E\u003Cspan class=\"msupsub\"\u003E\u003Cspan class=\"vlist-t vlist-t2\"\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.1514em;\"\u003E\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:2.7em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"sizing reset-size6 size3 mtight\"\u003E\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\"\u003Ev\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-s\"\u003E​\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.15em;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mclose\"\u003E)\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan style=\"top:-1.5285em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:3.5261em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mord\"\u003E\u003Cspan class=\"mord\"\u003E\u003Cspan class=\"mord text\"\u003E\u003Cspan class=\"mord\"\u003Ewhere head\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"msupsub\"\u003E\u003Cspan class=\"vlist-t vlist-t2\"\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.3117em;\"\u003E\u003Cspan style=\"top:-2.55em;margin-right:0.05em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:2.7em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"sizing reset-size6 size3 mtight\"\u003E\u003Cspan class=\"mord mathnormal mtight\"\u003Ei\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-s\"\u003E​\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.15em;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-s\"\u003E​\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:2.6576em;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"col-align-l\"\u003E\u003Cspan class=\"vlist-t vlist-t2\"\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:3.1576em;\"\u003E\u003Cspan style=\"top:-5.1576em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:3.5261em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mord\"\u003E\u003Cspan class=\"mord\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mrel\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mord text\"\u003E\u003Cspan class=\"mord\"\u003Esoftmax\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mopen\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mord\"\u003E\u003Cspan class=\"mopen nulldelimiter\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mfrac\"\u003E\u003Cspan class=\"vlist-t vlist-t2\"\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:1.5261em;\"\u003E\u003Cspan style=\"top:-2.2528em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:3em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mord\"\u003E\u003Cspan class=\"mord sqrt\"\u003E\u003Cspan class=\"vlist-t vlist-t2\"\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.8572em;\"\u003E\u003Cspan class=\"svg-align\" style=\"top:-3em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:3em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mord\" style=\"padding-left:0.833em;\"\u003E\u003Cspan class=\"mord\"\u003E\u003Cspan class=\"mord mathnormal\"\u003Ed\u003C\u002Fspan\u003E\u003Cspan class=\"msupsub\"\u003E\u003Cspan class=\"vlist-t vlist-t2\"\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.3361em;\"\u003E\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:2.7em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"sizing reset-size6 size3 mtight\"\u003E\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\"\u003Ek\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-s\"\u003E​\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.15em;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan style=\"top:-2.8172em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:3em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"\u003E\u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'\u003E\u003Cpath d='M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z'\u002F\u003E\u003C\u002Fsvg\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-s\"\u003E​\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.1828em;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan style=\"top:-3.23em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:3em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"frac-line\" style=\"border-bottom-width:0.04em;\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan style=\"top:-3.677em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:3em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mord\"\u003E\u003Cspan class=\"mord mathbf\"\u003EQ\u003C\u002Fspan\u003E\u003Cspan class=\"mord\"\u003E\u003Cspan class=\"mord\"\u003E\u003Cspan class=\"mord mathbf\"\u003EK\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"msupsub\"\u003E\u003Cspan class=\"vlist-t\"\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.8491em;\"\u003E\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:2.7em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"sizing reset-size6 size3 mtight\"\u003E\u003Cspan class=\"mord mtight\"\u003E⊤\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-s\"\u003E​\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.93em;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mclose nulldelimiter\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mclose\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\"\u003EV\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan style=\"top:-3.0876em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:3.5261em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mord\"\u003E\u003Cspan class=\"mord\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mrel\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mopen\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mord\"\u003E\u003Cspan class=\"mord text\"\u003E\u003Cspan class=\"mord\"\u003Ehead\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"msupsub\"\u003E\u003Cspan class=\"vlist-t vlist-t2\"\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.3011em;\"\u003E\u003Cspan style=\"top:-2.55em;margin-right:0.05em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:2.7em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"sizing reset-size6 size3 mtight\"\u003E\u003Cspan class=\"mord mtight\"\u003E1\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-s\"\u003E​\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.15em;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mpunct\"\u003E;\u003C\u002Fspan\u003E\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"minner\"\u003E…\u003C\u002Fspan\u003E\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mpunct\"\u003E;\u003C\u002Fspan\u003E\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mord\"\u003E\u003Cspan class=\"mord text\"\u003E\u003Cspan class=\"mord\"\u003Ehead\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"msupsub\"\u003E\u003Cspan class=\"vlist-t vlist-t2\"\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.3361em;\"\u003E\u003Cspan style=\"top:-2.55em;margin-right:0.05em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:2.7em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"sizing reset-size6 size3 mtight\"\u003E\u003Cspan class=\"mord mathnormal mtight\"\u003Eh\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-s\"\u003E​\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.15em;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mclose\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"mord\"\u003E\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\"\u003EW\u003C\u002Fspan\u003E\u003Cspan class=\"msupsub\"\u003E\u003Cspan class=\"vlist-t\"\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.7144em;\"\u003E\u003Cspan style=\"top:-3.113em;margin-right:0.05em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:2.7em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"sizing reset-size6 size3 mtight\"\u003E\u003Cspan class=\"mord mathnormal mtight\"\u003Eo\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan style=\"top:-1.5285em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:3.5261em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mord\"\u003E\u003Cspan class=\"mord\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mrel\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mord text\"\u003E\u003Cspan class=\"mord\"\u003EAttention\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mopen\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mord\"\u003E\u003Cspan class=\"mord mathbf\"\u003EX\u003C\u002Fspan\u003E\u003Cspan class=\"msupsub\"\u003E\u003Cspan class=\"vlist-t vlist-t2\"\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.1514em;\"\u003E\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:2.7em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"sizing reset-size6 size3 mtight\"\u003E\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\"\u003Eq\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-s\"\u003E​\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.2861em;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mord\"\u003E\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\"\u003EW\u003C\u002Fspan\u003E\u003Cspan class=\"msupsub\"\u003E\u003Cspan class=\"vlist-t vlist-t2\"\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.7823em;\"\u003E\u003Cspan style=\"top:-2.4231em;margin-left:-0.016em;margin-right:0.05em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:2.7em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"sizing reset-size6 size3 mtight\"\u003E\u003Cspan class=\"mord mathnormal mtight\"\u003Ei\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan style=\"top:-3.1809em;margin-right:0.05em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:2.7em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"sizing reset-size6 size3 mtight\"\u003E\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\"\u003Eq\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-s\"\u003E​\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.2769em;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mpunct\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mord\"\u003E\u003Cspan class=\"mord mathbf\"\u003EX\u003C\u002Fspan\u003E\u003Cspan class=\"msupsub\"\u003E\u003Cspan class=\"vlist-t vlist-t2\"\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.3361em;\"\u003E\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:2.7em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"sizing reset-size6 size3 mtight\"\u003E\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\"\u003Ek\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-s\"\u003E​\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.15em;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mord\"\u003E\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\"\u003EW\u003C\u002Fspan\u003E\u003Cspan class=\"msupsub\"\u003E\u003Cspan class=\"vlist-t vlist-t2\"\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.8991em;\"\u003E\u003Cspan style=\"top:-2.453em;margin-left:-0.016em;margin-right:0.05em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:2.7em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"sizing reset-size6 size3 mtight\"\u003E\u003Cspan class=\"mord mathnormal mtight\"\u003Ei\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan style=\"top:-3.113em;margin-right:0.05em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:2.7em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"sizing reset-size6 size3 mtight\"\u003E\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\"\u003Ek\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-s\"\u003E​\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.247em;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mpunct\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mord\"\u003E\u003Cspan class=\"mord mathbf\"\u003EX\u003C\u002Fspan\u003E\u003Cspan class=\"msupsub\"\u003E\u003Cspan class=\"vlist-t vlist-t2\"\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.1514em;\"\u003E\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:2.7em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"sizing reset-size6 size3 mtight\"\u003E\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\"\u003Ev\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-s\"\u003E​\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.15em;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mord\"\u003E\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\"\u003EW\u003C\u002Fspan\u003E\u003Cspan class=\"msupsub\"\u003E\u003Cspan class=\"vlist-t vlist-t2\"\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.7144em;\"\u003E\u003Cspan style=\"top:-2.453em;margin-left:-0.016em;margin-right:0.05em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:2.7em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"sizing reset-size6 size3 mtight\"\u003E\u003Cspan class=\"mord mathnormal mtight\"\u003Ei\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan style=\"top:-3.113em;margin-right:0.05em;\"\u003E\u003Cspan class=\"pstrut\" style=\"height:2.7em;\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"sizing reset-size6 size3 mtight\"\u003E\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\"\u003Ev\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-s\"\u003E​\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:0.247em;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"mclose\"\u003E)\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-s\"\u003E​\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"vlist-r\"\u003E\u003Cspan class=\"vlist\" style=\"height:2.6576em;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Ch3 id=\"encoder-layer\"\u003EEncoder Layer\u003Ca href=\"#encoder-layer\" class=\"anchor\"\u003E\u003Cspan class=\"visually-hidden\"\u003E#\u003C\u002Fspan\u003E\u003C\u002Fa\u003E\u003C\u002Fh3\u003E\u003Cdiv class=\"code-block python\"\u003E\u003Cpre class='language-python'\u003E\u003Ccode\u003E\u003Cspan class=\"token comment\"\u003E# https:\u002F\u002Fpytorch.org\u002Fdocs\u002Fstable\u002F_modules\u002Ftorch\u002Fnn\u002Fmodules\u002Ftransformer.html\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token keyword\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"token class-name\"\u003ETransformerEncoderLayer\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Enn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EModule\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token keyword\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003E__init__\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\n        self\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n        d_model\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token builtin\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E512\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n        nhead\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token builtin\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E8\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n        dim_feedforward\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token builtin\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E2048\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n        dropout\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token builtin\"\u003Efloat\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E0.1\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n        activation\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token builtin\"\u003Ecallable\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003ETensor\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E Tensor\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E F\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Erelu\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n        layer_norm_eps\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token builtin\"\u003Efloat\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E1e-5\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n        batch_first\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token builtin\"\u003Ebool\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003ETrue\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E  \u003Cspan class=\"token comment\"\u003E# (default: `False`), Why is the default of `batch_first` False?\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003ENone\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"token builtin\"\u003Esuper\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003ETransformerEncoderLayer\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E self\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E__init__\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"token comment\"\u003E# (1) Multi-head Attention\u003C\u002Fspan\u003E\n        self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Eself_attn \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E nn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EMultiheadAttention\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\n            d_model\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E nhead\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E dropout\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003Edropout\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E batch_first\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003Ebatch_first\n        \u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"token comment\"\u003E# (2) Feedforward\u003C\u002Fspan\u003E\n        self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Elinear1 \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E nn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003ELinear\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ed_model\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E dim_feedforward\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n        self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Edropout \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E nn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EDropout\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Edropout\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n        self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Elinear2 \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E nn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003ELinear\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Edim_feedforward\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E d_model\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\n        self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Enorm1 \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E nn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003ELayerNorm\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ed_model\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E eps\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003Elayer_norm_eps\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n        self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Enorm2 \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E nn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003ELayerNorm\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ed_model\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E eps\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003Elayer_norm_eps\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n        self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Edropout1 \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E nn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EDropout\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Edropout\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n        self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Edropout2 \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E nn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EDropout\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Edropout\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"token keyword\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Eforward\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\n        self\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E src\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E Tensor\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E src_mask\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003ENone\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E|\u003C\u002Fspan\u003E Tensor\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E src_key_padding_mask\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003ENone\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E|\u003C\u002Fspan\u003E Tensor\n    \u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"token triple-quoted-string string\"\u003E\"\"\"\n        `N`: batch size\n        `S`: sequence length\n        `E`: embeddins feature dim\n        src: `(N, S, E)` if batch_first=True\n        \"\"\"\u003C\u002Fspan\u003E\n        x \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E src\n        x \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Enorm1\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ex \u003Cspan class=\"token operator\"\u003E+\u003C\u002Fspan\u003E self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E_sa_block\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ex\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E src_mask\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E src_key_padding_mask\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n        x \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Enorm2\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ex \u003Cspan class=\"token operator\"\u003E+\u003C\u002Fspan\u003E self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E_ff_block\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ex\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"token comment\"\u003E# self-attention block\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token keyword\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003E_sa_block\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\n        self\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E x\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E Tensor\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E attn_mask\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003ENone\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E|\u003C\u002Fspan\u003E Tensor\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E key_padding_mask\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003ENone\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E|\u003C\u002Fspan\u003E Tensor\n    \u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E Tensor\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"token comment\"\u003E# Input: (N, S, E)\u003C\u002Fspan\u003E\n        x \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Eself_attn\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ex\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E x\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E x\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n            attn_mask\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003Eattn_mask\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n            key_padding_mask\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003Ekey_padding_mask\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n        \u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E  \u003Cspan class=\"token comment\"\u003E# -\u003E (Tensor(N, S, E), Tensor(N, S, S))\u003C\u002Fspan\u003E\n        \u003Cspan class=\"token comment\"\u003E# attn's output[1] is self-attention matrix\u003C\u002Fspan\u003E\n        \u003Cspan class=\"token comment\"\u003E# q_scaled = q \u002F math.sqrt(E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"token comment\"\u003E# attn_output_weights = torch.bmm(q_scaled, k.transpose(-2, -1))\u003C\u002Fspan\u003E\n        \u003Cspan class=\"token keyword\"\u003Ereturn\u003C\u002Fspan\u003E self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Edropout1\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ex\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E  \u003Cspan class=\"token comment\"\u003E# (N, S, 512)\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"token comment\"\u003E# feed-forward block\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token keyword\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003E_ff_block\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Eself\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E x\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E Tensor\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E Tensor\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"token comment\"\u003E# Input: (N, S, 512)\u003C\u002Fspan\u003E\n        x \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Edropout\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Eself\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Eactivation\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Eself\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Elinear1\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ex\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E  \u003Cspan class=\"token comment\"\u003E# (N, S, 2048)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"token keyword\"\u003Ereturn\u003C\u002Fspan\u003E self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Edropout2\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Eself\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Elinear2\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ex\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E  \u003Cspan class=\"token comment\"\u003E# (N, S, 512)\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Ch3 id=\"decoder-layer\"\u003EDecoder Layer\u003Ca href=\"#decoder-layer\" class=\"anchor\"\u003E\u003Cspan class=\"visually-hidden\"\u003E#\u003C\u002Fspan\u003E\u003C\u002Fa\u003E\u003C\u002Fh3\u003E\u003Cdiv class=\"code-block python\"\u003E\u003Cpre class='language-python'\u003E\u003Ccode\u003E\u003Cspan class=\"token comment\"\u003E# https:\u002F\u002Fpytorch.org\u002Fdocs\u002Fstable\u002F_modules\u002Ftorch\u002Fnn\u002Fmodules\u002Ftransformer.html\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token keyword\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"token class-name\"\u003ETransformerDecoderLayer\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Enn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EModule\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token keyword\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003E__init__\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\n        self\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n        d_model\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token builtin\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E512\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n        nhead\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token builtin\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E8\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n        dim_feedforward\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token builtin\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E2048\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n        activation\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token builtin\"\u003Ecallable\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003ETensor\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E Tensor\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E F\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Erelu\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n        dropout\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token builtin\"\u003Efloat\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E0.1\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n        layer_norm_eps\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token builtin\"\u003Efloat\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E1e-5\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n        batch_first\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token builtin\"\u003Ebool\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003ETrue\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E  \u003Cspan class=\"token comment\"\u003E# default: False\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003ENone\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"token builtin\"\u003Esuper\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003ETransformerDecoderLayer\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E self\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E__init__\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\n        self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Eself_attn \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E nn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EMultiheadAttention\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\n            d_model\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E nhead\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E dropout\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003Edropout\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E batch_first\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003Ebatch_first\n        \u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\n        self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Emultihead_attn \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E nn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EMultiheadAttention\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\n            d_model\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E nhead\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E dropout\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003Edropout\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E batch_first\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003Ebatch_first\n        \u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"token comment\"\u003E# Implementation of Feedforward model\u003C\u002Fspan\u003E\n        self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Elinear1 \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E nn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003ELinear\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ed_model\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E dim_feedforward\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n        self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Edropout \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E nn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EDropout\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Edropout\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n        self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Elinear2 \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E nn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003ELinear\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Edim_feedforward\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E d_model\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\n        self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Enorm1 \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E nn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003ELayerNorm\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ed_model\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E eps\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003Elayer_norm_eps\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n        self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Enorm2 \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E nn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003ELayerNorm\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ed_model\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E eps\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003Elayer_norm_eps\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n        self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Enorm3 \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E nn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003ELayerNorm\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ed_model\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E eps\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003Elayer_norm_eps\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n        self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Edropout1 \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E nn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EDropout\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Edropout\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n        self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Edropout2 \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E nn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EDropout\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Edropout\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n        self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Edropout3 \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E nn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EDropout\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Edropout\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\n        self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Eactivation \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E activation\n\n    \u003Cspan class=\"token keyword\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Eforward\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\n        self\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n        tgt\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E Tensor\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n        memory\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E Tensor\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n        tgt_mask\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E Tensor \u003Cspan class=\"token operator\"\u003E|\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003ENone\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003ENone\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n        memory_mask\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E Tensor \u003Cspan class=\"token operator\"\u003E|\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003ENone\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003ENone\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n        tgt_key_padding_mask\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E Tensor \u003Cspan class=\"token operator\"\u003E|\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003ENone\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003ENone\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n        memory_key_padding_mask\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E Tensor \u003Cspan class=\"token operator\"\u003E|\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003ENone\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003ENone\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E Tensor\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"token triple-quoted-string string\"\u003E\"\"\"\n        `N`: batch size\n        `S`: memory sequence length (output from the last layer of the encoder)\n        `T`: target sequence length\n        tgt: `(N, T, 512)` if batch_first=True\n        memory: `(N, S, 512)` if batch_first=True\n        \"\"\"\u003C\u002Fspan\u003E\n        \u003Cspan class=\"token comment\"\u003E# see Fig. 1 of https:\u002F\u002Farxiv.org\u002Fpdf\u002F2002.04745v1.pdf\u003C\u002Fspan\u003E\n\n        x \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E tgt\n        x \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Enorm1\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ex \u003Cspan class=\"token operator\"\u003E+\u003C\u002Fspan\u003E self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E_sa_block\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ex\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E tgt_mask\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E tgt_key_padding_mask\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n        x \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Enorm2\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\n            x \u003Cspan class=\"token operator\"\u003E+\u003C\u002Fspan\u003E self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E_mha_block\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ex\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E memory\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E memory_mask\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E memory_key_padding_mask\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n        x \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Enorm3\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ex \u003Cspan class=\"token operator\"\u003E+\u003C\u002Fspan\u003E self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E_ff_block\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ex\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"token keyword\"\u003Ereturn\u003C\u002Fspan\u003E x\n\n    \u003Cspan class=\"token comment\"\u003E# self-attention block\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token keyword\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003E_sa_block\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\n        self\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E x\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E Tensor\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E attn_mask\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E Tensor \u003Cspan class=\"token operator\"\u003E|\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003ENone\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E key_padding_mask\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E Tensor \u003Cspan class=\"token operator\"\u003E|\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003ENone\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E Tensor\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n        x \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Eself_attn\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ex\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E x\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E x\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n            attn_mask\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003Eattn_mask\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n            key_padding_mask\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003Ekey_padding_mask\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n            need_weights\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"token boolean\"\u003EFalse\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n        \u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E\n        \u003Cspan class=\"token keyword\"\u003Ereturn\u003C\u002Fspan\u003E self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Edropout1\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ex\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E  \u003Cspan class=\"token comment\"\u003E# (N, T, 512)\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"token comment\"\u003E# Different from Encoder\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token comment\"\u003E# multihead attention block\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token keyword\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003E_mha_block\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\n        self\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n        x\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E Tensor\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n        mem\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E Tensor\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E  \u003Cspan class=\"token comment\"\u003E# from the encoder\u003C\u002Fspan\u003E\n        attn_mask\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E Tensor \u003Cspan class=\"token operator\"\u003E|\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003ENone\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n        key_padding_mask\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E Tensor \u003Cspan class=\"token operator\"\u003E|\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003ENone\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E Tensor\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n        x \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Emultihead_attn\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ex\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E mem\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E mem\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n            attn_mask\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003Eattn_mask\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n            key_padding_mask\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003Ekey_padding_mask\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n            need_weights\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"token boolean\"\u003EFalse\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n        \u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E  \u003Cspan class=\"token comment\"\u003E# ((N, T, 512)\u002Fsqrt(512))@(N, S, 512).T@(N, S, 512) -\u003E (N, T, 512)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"token keyword\"\u003Ereturn\u003C\u002Fspan\u003E self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Edropout2\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ex\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E  \u003Cspan class=\"token comment\"\u003E# (N, T, 512)\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"token comment\"\u003E# feed forward block\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token keyword\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003E_ff_block\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Eself\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E x\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E Tensor\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E Tensor\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n        x \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Edropout\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Eself\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Eactivation\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Eself\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Elinear1\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ex\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E  \u003Cspan class=\"token comment\"\u003E# (N, T, 2048)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"token keyword\"\u003Ereturn\u003C\u002Fspan\u003E self\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Edropout3\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Eself\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Elinear2\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ex\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E  \u003Cspan class=\"token comment\"\u003E# (N, T, 512)\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cblockquote\u003E\n\u003Cp\u003EFrom ChatGPT\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Cp\u003EWhy \u003Ccode\u003Ebatch_first\u003C\u002Fcode\u003E is False?\u003C\u002Fp\u003E\n\u003Cp\u003E  The \u003Ccode\u003Ebatch_first\u003C\u002Fcode\u003E argument is \u003Ccode\u003EFalse\u003C\u002Fcode\u003E, which means that the sequence (time) dimension is listed first in the input tensor.\u003C\u002Fp\u003E\n\u003Cp\u003E  The reason for this choice is historical, as it reflects the convention used in the original Transformer paper by Vaswani et al. (2017), which has since become a standard in the field of NLP. By using the same convention, researchers and practitioners can easily compare and replicate the results from existing literature, as well as leverage existing code and resources.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cp\u003EBut, batch_first is more memory-efficient!\u003C\u002Fp\u003E\n\u003Cp\u003E  However, it is worth noting that the choice of batch_first can affect the memory usage and performance of a model, as the batch dimension is typically the largest dimension, and it is more memory-efficient to have the batch dimension first.\u003C\u002Fp\u003E\n\u003Cp\u003E  On the other hand, if the sequence dimension was first, then each batch example would be stored in a separate block of memory, leading to more frequent cache misses and slower memory access.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cp\u003EBut, It is calculated in the form of \u003Ccode\u003E(squence length, batch_size, features)\u003C\u002Fcode\u003E in \u003Ccode\u003Enn.MultiheadAttention\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n"],"uses":{"params":["path","slug"]}}]}
